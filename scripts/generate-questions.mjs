/* eslint-disable no-console */
import fs from "node:fs";
import path from "node:path";

function mulberry32(seed) {
  let t = seed >>> 0;
  return function () {
    t += 0x6d2b79f5;
    let r = Math.imul(t ^ (t >>> 15), 1 | t);
    r ^= r + Math.imul(r ^ (r >>> 7), 61 | r);
    return ((r ^ (r >>> 14)) >>> 0) / 4294967296;
  };
}

const rng = mulberry32(1337);

function randInt(min, max) {
  return Math.floor(rng() * (max - min + 1)) + min;
}

function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(rng() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}

function uniq(arr) {
  return [...new Set(arr)];
}

let counter = 0;
function qid() {
  counter += 1;
  return `q_${String(counter).padStart(5, "0")}`;
}

function makeMCQ({ category, question, correct, wrongs, explanation, difficulty }) {
  const wrongPool = uniq(wrongs).filter((x) => x !== correct);
  while (wrongPool.length < 3) {
    wrongPool.push(generateFallbackWrong(correct, wrongPool));
  }
  const pickedWrongs = shuffle([...wrongPool]).slice(0, 3);
  const all = shuffle([correct, ...pickedWrongs]);
  const answerIndex = all.indexOf(correct);
  if (answerIndex < 0 || all.length !== 4) throw new Error("Bad MCQ generation");
  return {
    id: qid(),
    category,
    question,
    choices: all,
    answerIndex,
    explanation,
    difficulty
  };
}

function generateFallbackWrong(correct, existing) {
  const exists = (x) => x === correct || existing.includes(x);
  // numeric string fallback
  if (/^-?\d+$/.test(String(correct))) {
    const n = Number(correct);
    for (let t = 0; t < 50; t++) {
      const candidate = String(n + randInt(-25, 25) + (t % 2 === 0 ? 1 : 0));
      if (!exists(candidate)) return candidate;
    }
    return String(n + 1);
  }

  const pool = [
    "Улаанбаатар",
    "Токио",
    "Москва",
    "Лондон",
    "Парис",
    "Ром",
    "Берлин",
    "Бээжин",
    "Сөүл",
    "Каир",
    "Анкара",
    "Шинэ Дели",
    "Бангкок",
    "Ханой",
    "Жакарта",
    "Канберра",
    "Лима",
    "Богота",
    "Афин"
  ];

  for (let t = 0; t < 200; t++) {
    const candidate = pool[randInt(0, pool.length - 1)];
    if (!exists(candidate)) return candidate;
  }
  // last resort
  return "Дээрхээс аль нь ч биш";
}

function makeDirectMCQ({ category, question, choices, answerIndex, explanation, difficulty }) {
  if (!choices || choices.length !== 4) throw new Error("choices must be 4");
  return {
    id: qid(),
    category,
    question,
    choices,
    answerIndex,
    explanation,
    difficulty
  };
}

const questions = [];

// -----------------------------
// KNOWLEDGE-TRIVIA (curated, safe)
// -----------------------------

const knowledgeTrivia = [
  // Geography / nature
  {
    category: "Ерөнхий",
    question: "Дэлхийн хамгийн том далай аль вэ?",
    choices: ["Номхон далай", "Атлантын далай", "Энэтхэгийн далай", "Хойд мөсөн далай"],
    answerIndex: 0,
    explanation: "Номхон далай нь талбайгаар хамгийн том."
  },
  {
    category: "Газарзүй",
    question: "Дэлхийн хамгийн өндөр уулын оргил аль вэ?",
    choices: ["Эверест", "Килиманжаро", "Эльбрус", "Аконкагуа"],
    answerIndex: 0,
    explanation: "Далайн түвшнээс хамгийн өндөр оргил нь Эверест."
  },
  {
    category: "Байгаль",
    question: "Хүлэмжийн хийд хамгийн түгээмэл хамаарах аль вэ?",
    choices: ["Нүүрсхүчлийн хий (CO₂)", "Гели (He)", "Неон (Ne)", "Аргон (Ar)"],
    answerIndex: 0,
    explanation: "CO₂ нь хүлэмжийн хийн гол төлөөлөл."
  },
  // Science
  {
    category: "Шинжлэх ухаан",
    question: "Усны химийн томьёо аль вэ?",
    choices: ["H₂O", "CO₂", "O₂", "NaCl"],
    answerIndex: 0,
    explanation: "Ус = H₂O."
  },
  {
    category: "Шинжлэх ухаан",
    question: "Хүний биед хүчилтөрөгчийг цусанд шингээдэг эрхтэн аль вэ?",
    choices: ["Уушги", "Элэг", "Бөөр", "Нойр булчирхай"],
    answerIndex: 0,
    explanation: "Уушгины цулцангаар хүчилтөрөгч солилцоно."
  },
  {
    category: "Шинжлэх ухаан",
    question: "Нарны аймгийн “улаан гариг” гэж аль гаригийг нэрлэх вэ?",
    choices: ["Ангараг", "Сугар", "Бархасбадь", "Буд"],
    answerIndex: 0,
    explanation: "Ангараг гариг улаавтар өнгөөрөө алдартай."
  },
  // Mongolia
  {
    category: "Монгол",
    question: "Монгол Улс ямар хоёр улстай хиллэдэг вэ?",
    choices: ["ОХУ ба БНХАУ", "Казахстан ба Хятад", "ОХУ ба Япон", "БНСУ ба Хятад"],
    answerIndex: 0,
    explanation: "Монгол Улс ОХУ, БНХАУ-тай хиллэдэг."
  },
  {
    category: "Монгол",
    question: "Монгол Улсын мөнгөн тэмдэгт юу вэ?",
    choices: ["Төгрөг", "Рубли", "Юань", "Доллар"],
    answerIndex: 0,
    explanation: "Монголын мөнгөн тэмдэгт: төгрөг."
  },
  // History (safe, broad)
  {
    category: "Түүх",
    question: "‘Ренессанс’ гэж ерөнхийдөө юуг нэрлэх вэ?",
    choices: ["Европт соёл, урлаг сэргэсэн үе", "Аж үйлдвэржилт эхэлсэн үе", "Дэлхийн II дайн", "Колоничлолын төгсгөл"],
    answerIndex: 0,
    explanation: "Ренессанс бол Европын соёл, урлаг, шинжлэх ухаан сэргэсэн үе."
  },
  // Culture
  {
    category: "Соёл",
    question: "Морин хуур нь аль улсын уламжлалт хөгжмийн зэмсэг вэ?",
    choices: ["Монгол", "Япон", "Франц", "Бразил"],
    answerIndex: 0,
    explanation: "Морин хуур бол Монголын уламжлалт хөгжим."
  }
];

// Mongolia-first everyday trivia (average Mongolian, simple & fun)
const mongoliaEverydayTrivia = [
  {
    category: "Монгол",
    question: "Улаанбаатар хотын төв талбайн нэр аль вэ?",
    choices: ["Сүхбаатарын талбай", "Энхтайваны талбай", "Наадмын талбай", "Төв цэнгэлдэхийн талбай"],
    answerIndex: 0,
    explanation: "Улаанбаатар хотын төв талбайг Сүхбаатарын талбай гэж нэрлэдэг."
  },
  {
    category: "Монгол",
    question: "Монголын үндэсний баяр наадам ихэвчлэн хэддүгээр сард болдог вэ?",
    choices: ["7-р сар", "1-р сар", "10-р сар", "4-р сар"],
    answerIndex: 0,
    explanation: "Наадам ихэвчлэн 7-р сарын 11–13-нд болдог."
  },
  {
    category: "Монгол",
    question: "Монголын уламжлалт спортын “гурван наадам” аль нь вэ?",
    choices: ["Бөх, сур, морь", "Сагс, хөлбөмбөг, волейбол", "Шатар, даам, гүйлт", "Бокс, жүдо, каратэ"],
    answerIndex: 0,
    explanation: "Үндэсний баяр наадмын гурван наадам: бөх, сур, морь."
  },
  {
    category: "Монгол",
    question: "Монголын мөнгөн тэмдэгт юу вэ?",
    choices: ["Төгрөг", "Рубли", "Юань", "Доллар"],
    answerIndex: 0,
    explanation: "Монголын мөнгөн тэмдэгт: төгрөг."
  },
  {
    category: "Монгол",
    question: "Монгол Улс ямар хоёр улстай хиллэдэг вэ?",
    choices: ["ОХУ ба БНХАУ", "Казахстан ба Хятад", "ОХУ ба Япон", "БНСУ ба Хятад"],
    answerIndex: 0,
    explanation: "Монгол Улс ОХУ, БНХАУ-тай хиллэдэг."
  },
  {
    category: "Монгол",
    question: "Улаанбаатар хот хэдэн дүүрэгтэй вэ?",
    choices: ["9", "6", "12", "15"],
    answerIndex: 0,
    explanation: "Улаанбаатар хот 9 дүүрэгтэй."
  },
  {
    category: "Монгол",
    question: "Доорх аль нь Улаанбаатарын дүүрэг вэ?",
    choices: ["Баянзүрх", "Баянхонгор", "Зүүнхараа", "Хархорин"],
    answerIndex: 0,
    explanation: "Баянзүрх бол Улаанбаатарын нэг дүүрэг."
  },
  {
    category: "Монгол",
    question: "Доорх аль нь Улаанбаатарын дүүрэг вэ?",
    choices: ["Хан-Уул", "Улиастай", "Сайншанд", "Өлгий"],
    answerIndex: 0,
    explanation: "Хан-Уул бол Улаанбаатарын нэг дүүрэг."
  },
  {
    category: "Монгол",
    question: "Доорх аль нь Улаанбаатарын дүүрэг вэ?",
    choices: ["Сүхбаатар", "Мөрөн", "Дархан", "Чойбалсан"],
    answerIndex: 0,
    explanation: "Сүхбаатар бол Улаанбаатарын нэг дүүрэг."
  },
  {
    category: "Монгол",
    question: "Монголын хамгийн гүн нуур аль вэ?",
    choices: ["Хөвсгөл нуур", "Увс нуур", "Хяргас нуур", "Буйр нуур"],
    answerIndex: 0,
    explanation: "Хөвсгөл нуур нь Монголын хамгийн гүн нуур."
  },
  {
    category: "Монгол",
    question: "Доорх аль нь Монголын уламжлалт хоол вэ?",
    choices: ["Бууз", "Суши", "Тако", "Паста"],
    answerIndex: 0,
    explanation: "Бууз бол Монголын уламжлалт хоол."
  },
  {
    category: "Монгол",
    question: "Доорх аль нь Монголын уламжлалт хоол вэ?",
    choices: ["Хуушуур", "Пицца", "Кебаб", "Рамен"],
    answerIndex: 0,
    explanation: "Хуушуур бол Монголын уламжлалт хоол."
  },
  {
    category: "Монгол",
    question: "Айраг ямар малын сүүгээр хамгийн түгээмэл исгэдэг вэ?",
    choices: ["Гүүний сүү", "Үхрийн сүү", "Тэмээний сүү", "Ямааны сүү"],
    answerIndex: 0,
    explanation: "Айраг ихэвчлэн гүүний сүүгээр исгэнэ."
  },
  {
    category: "Монгол",
    question: "Монголын уламжлалт сууц юу вэ?",
    choices: ["Гэр", "Байшин", "Суудлын вагон", "Майхан"],
    answerIndex: 0,
    explanation: "Монголын уламжлалт сууц нь гэр."
  },
  {
    category: "Монгол",
    question: "Соёмбо гэж юу вэ?",
    choices: ["Монголын төрийн бэлгэдлийн тэмдэг", "Монгол мөнгөн тэмдэгт", "Аймгийн нэр", "Бөхийн цол"],
    answerIndex: 0,
    explanation: "Соёмбо бол Монголын төрийн бэлгэдлийн тэмдэг."
  }
];

const ubDistricts = ["Баянзүрх", "Сүхбаатар", "Чингэлтэй", "Баянгол", "Хан-Уул", "Сонгинохайрхан", "Налайх", "Багануур", "Багахангай"];
const mongolianFoods = ["Бууз", "Хуушуур", "Цуйван", "Банш", "Банштай цай", "Будаатай хуурга", "Шөлтэй гурил", "Боорцог"];
const mongolianDairy = ["Айраг", "Ааруул", "Өрөм", "Шар тос", "Тараг", "Ээзгий"];
const nonMongolianFoods = ["Суши", "Пицца", "Тако", "Паста", "Рамен", "Кебаб", "Буррито", "Карри"];

// -----------------------------
// FACT LISTS (MN)
// -----------------------------

const mongoliaAimagCenters = [
  ["Архангай", "Цэцэрлэг"],
  ["Баян-Өлгий", "Өлгий"],
  ["Баянхонгор", "Баянхонгор"],
  ["Булган", "Булган"],
  ["Говь-Алтай", "Алтай"],
  ["Говьсүмбэр", "Чойр"],
  ["Дархан-Уул", "Дархан"],
  ["Дорноговь", "Сайншанд"],
  ["Дорнод", "Чойбалсан"],
  ["Дундговь", "Мандалговь"],
  ["Завхан", "Улиастай"],
  ["Орхон", "Эрдэнэт"],
  ["Өвөрхангай", "Арвайхээр"],
  ["Өмнөговь", "Даланзадгад"],
  ["Сүхбаатар", "Баруун-Урт"],
  ["Сэлэнгэ", "Сүхбаатар"],
  ["Төв", "Зуунмод"],
  ["Увс", "Улаангом"],
  ["Ховд", "Ховд"],
  ["Хөвсгөл", "Мөрөн"],
  ["Хэнтий", "Чингис"]
];

const worldCapitals = [
  ["Япон", "Токио"],
  ["БНСУ", "Сөүл"],
  ["Хятад", "Бээжин"],
  ["ОХУ", "Москва"],
  ["АНУ", "Вашингтон D.C."],
  ["Канад", "Оттава"],
  ["Их Британи", "Лондон"],
  ["Франц", "Парис"],
  ["Герман", "Берлин"],
  ["Итали", "Ром"],
  ["Испани", "Мадрид"],
  ["Португал", "Лиссабон"],
  ["Нидерланд", "Амстердам"],
  ["Бельги", "Брюссель"],
  ["Швейцарь", "Берн"],
  ["Швед", "Стокгольм"],
  ["Норвеги", "Осло"],
  ["Финлянд", "Хельсинки"],
  ["Польш", "Варшав"],
  ["Украин", "Киев"],
  ["Турк", "Анкара"],
  ["Грек", "Афин"],
  ["Египет", "Каир"],
  ["Саудын Араб", "Эр-Рияд"],
  ["АНЭУ", "Абу Даби"],
  ["Катар", "Доха"],
  ["Энэтхэг", "Шинэ Дели"],
  ["Пакистан", "Исламабад"],
  ["Иран", "Тегеран"],
  ["Ирак", "Багдад"],
  ["Тайланд", "Бангкок"],
  ["Вьетнам", "Ханой"],
  ["Малайз", "Куала Лумпур"],
  ["Сингапур", "Сингапур"],
  ["Индонез", "Жакарта"],
  ["Филиппин", "Манила"],
  ["Австрали", "Канберра"],
  ["Шинэ Зеланд", "Веллингтон"],
  ["Бразил", "Бразилиа"],
  ["Аргентин", "Буэнос-Айрес"],
  ["Чили", "Сантьяго"],
  ["Перу", "Лима"],
  ["Колумб", "Богота"],
  ["Мексик", "Мехико хот"],
  ["Куба", "Гавана"],
  ["Өмнөд Африк", "Преториа"],
  ["Нигери", "Абуджа"],
  ["Кени", "Найроби"],
  ["Этиоп", "Аддис-Абеба"],
  ["Марокко", "Рабат"],
  ["Тунис", "Тунис хот"],
  ["Алжир", "Алжир хот"],
  ["Сенегал", "Дакар"],
  ["Гана", "Аккра"],
  ["Кот-д’Ивуар", "Ямусукро"],
  ["Камерун", "Яунде"],
  ["Уганда", "Кампала"],
  ["Танзани", "Додома"],
  ["Замби", "Лусака"],
  ["Зимбабве", "Хараре"],
  ["Ангол", "Луанда"],
  ["Мозамбик", "Мапуту"],
  ["Намиби", "Виндхук"],
  ["Ботсвана", "Габороне"],
  ["Исланд", "Рейкьявик"],
  ["Ирланд", "Дублин"],
  ["Дани", "Копенхаген"],
  ["Австри", "Вена"],
  ["Чех", "Прага"],
  ["Словак", "Братислава"],
  ["Унгар", "Будапешт"],
  ["Румын", "Бухарест"],
  ["Болгар", "София"],
  ["Серби", "Белград"],
  ["Хорват", "Загреб"],
  ["Словени", "Любляна"],
  ["Босни ба Херцеговин", "Сараево"],
  ["Хойд Македон", "Скопье"],
  ["Албани", "Тирана"],
  ["Литва", "Вильнюс"],
  ["Латви", "Рига"],
  ["Эстони", "Таллин"],
  ["Беларусь", "Минск"],
  ["Гүрж", "Тбилиси"],
  ["Армени", "Ереван"],
  ["Азербайжан", "Баку"],
  ["Израиль", "Иерусалим"],
  ["Йордан", "Амман"],
  ["Ливан", "Бейрут"],
  ["Сири", "Дамаск"],
  ["Йемен", "Санаа"],
  ["Оман", "Маскат"],
  ["Кувейт", "Кувейт хот"],
  ["Бахрейн", "Манама"],
  ["Афганистан", "Кабул"],
  ["Непал", "Катманду"],
  ["Шри-Ланка", "Шри Жаяварденепура Котте"],
  ["Бангладеш", "Дакка"],
  ["Мьянмар", "Нейпьидо"],
  ["Камбож", "Пномпень"],
  ["Лаос", "Вьентьян"],
  ["Монгол", "Улаанбаатар"],
  ["Казахстан", "Астана"],
  ["Узбекистан", "Ташкент"],
  ["Киргизстан", "Бишкек"],
  ["Тажикстан", "Душанбе"],
  ["Туркменистан", "Ашхабад"],
  // (Швейцарь нь Берн — дээр аль хэдийн байгаа, давхардал/алдааг зориудаар оруулахгүй)
  ["Боливи", "Сукре"],
  ["Венесуэл", "Каракас"],
  ["Эквадор", "Кито"],
  ["Уругвай", "Монтевидео"],
  ["Парагвай", "Асунсьон"],
  ["Доминикан", "Санто Доминго"],
  ["Коста-Рика", "Сан-Хосе"],
  ["Панам", "Панама хот"],
  ["Гватемал", "Гватемал хот"],
  ["Гондурас", "Тегусигальпа"],
  ["Никарагуа", "Манагуа"],
  ["Сальвадор", "Сан-Сальвадор"],
  ["Ямайка", "Кингстон"],
  ["Барбадос", "Бриджтаун"]
];

const countryContinents = [
  ["Япон", "Ази"],
  ["БНСУ", "Ази"],
  ["Хятад", "Ази"],
  ["Монгол", "Ази"],
  ["Энэтхэг", "Ази"],
  ["Вьетнам", "Ази"],
  ["Тайланд", "Ази"],
  ["Индонез", "Ази"],
  ["Филиппин", "Ази"],
  ["Малайз", "Ази"],
  ["Сингапур", "Ази"],
  ["Пакистан", "Ази"],
  ["Иран", "Ази"],
  ["Ирак", "Ази"],
  ["Саудын Араб", "Ази"],
  ["АНЭУ", "Ази"],
  ["Катар", "Ази"],
  ["Оман", "Ази"],
  ["Израиль", "Ази"],
  ["Йордан", "Ази"],
  ["Непал", "Ази"],
  ["Шри-Ланка", "Ази"],
  ["Бангладеш", "Ази"],
  ["Мьянмар", "Ази"],
  ["Лаос", "Ази"],
  ["Камбож", "Ази"],
  ["Австрали", "Далайн орнууд"],
  ["Шинэ Зеланд", "Далайн орнууд"],
  ["Франц", "Европ"],
  ["Герман", "Европ"],
  ["Итали", "Европ"],
  ["Испани", "Европ"],
  ["Португал", "Европ"],
  ["Их Британи", "Европ"],
  ["Ирланд", "Европ"],
  ["Исланд", "Европ"],
  ["Нидерланд", "Европ"],
  ["Бельги", "Европ"],
  ["Швейцарь", "Европ"],
  ["Австри", "Европ"],
  ["Чех", "Европ"],
  ["Словак", "Европ"],
  ["Польш", "Европ"],
  ["Украин", "Европ"],
  ["Румын", "Европ"],
  ["Болгар", "Европ"],
  ["Грек", "Европ"],
  ["Дани", "Европ"],
  ["Швед", "Европ"],
  ["Норвеги", "Европ"],
  ["Финлянд", "Европ"],
  ["Литва", "Европ"],
  ["Латви", "Европ"],
  ["Эстони", "Европ"],
  ["АНУ", "Хойд Америк"],
  ["Канад", "Хойд Америк"],
  ["Мексик", "Хойд Америк"],
  ["Куба", "Хойд Америк"],
  ["Ямайка", "Хойд Америк"],
  ["Панам", "Хойд Америк"],
  ["Коста-Рика", "Хойд Америк"],
  ["Гватемал", "Хойд Америк"],
  ["Гондурас", "Хойд Америк"],
  ["Никарагуа", "Хойд Америк"],
  ["Сальвадор", "Хойд Америк"],
  ["Бразил", "Өмнөд Америк"],
  ["Аргентин", "Өмнөд Америк"],
  ["Чили", "Өмнөд Америк"],
  ["Перу", "Өмнөд Америк"],
  ["Колумб", "Өмнөд Америк"],
  ["Эквадор", "Өмнөд Америк"],
  ["Венесуэл", "Өмнөд Америк"],
  ["Уругвай", "Өмнөд Америк"],
  ["Парагвай", "Өмнөд Америк"],
  ["Боливи", "Өмнөд Америк"],
  ["Египет", "Африк"],
  ["Марокко", "Африк"],
  ["Алжир", "Африк"],
  ["Тунис", "Африк"],
  ["Сенегал", "Африк"],
  ["Гана", "Африк"],
  ["Нигери", "Африк"],
  ["Кени", "Африк"],
  ["Этиоп", "Африк"],
  ["Танзани", "Африк"],
  ["Уганда", "Африк"],
  ["Өмнөд Африк", "Африк"],
  ["Ангол", "Африк"],
  ["Замби", "Африк"],
  ["Зимбабве", "Африк"],
  ["Намиби", "Африк"],
  ["Ботсвана", "Африк"],
  // нэмэлт улсууд (мэдлэг/тривиа хэв маяг)
  ["БНАСАУ", "Ази"],
  ["Тайвань", "Ази"],
  ["Гонконг", "Ази"],
  ["Макао", "Ази"],
  ["Мальдив", "Ази"],
  ["Бутан", "Ази"],
  ["Саудын Араб", "Ази"],
  ["Кувейт", "Ази"],
  ["Бахрейн", "Ази"],
  ["Ирак", "Ази"],
  ["Сири", "Ази"],
  ["Ливан", "Ази"],
  ["Йемен", "Ази"],
  ["Афганистан", "Ази"],
  ["Казахстан", "Ази"],
  ["Узбекистан", "Ази"],
  ["Киргизстан", "Ази"],
  ["Тажикстан", "Ази"],
  ["Туркменистан", "Ази"],
  ["Малайз", "Ази"],
  ["Сингапур", "Ази"],
  ["Индонез", "Ази"],
  ["Филиппин", "Ази"],
  ["Бруней", "Ази"],
  ["Тимор-Лесте", "Ази"],
  ["Япон", "Ази"],
  ["БНСУ", "Ази"],
  ["Хятад", "Ази"],
  ["Монгол", "Ази"],
  // Европ
  ["Португал", "Европ"],
  ["Испани", "Европ"],
  ["Франц", "Европ"],
  ["Их Британи", "Европ"],
  ["Ирланд", "Европ"],
  ["Нидерланд", "Европ"],
  ["Бельги", "Европ"],
  ["Люксембург", "Европ"],
  ["Герман", "Европ"],
  ["Швейцарь", "Европ"],
  ["Австри", "Европ"],
  ["Итали", "Европ"],
  ["Мальта", "Европ"],
  ["Кипр", "Европ"],
  ["Чех", "Европ"],
  ["Словак", "Европ"],
  ["Унгар", "Европ"],
  ["Словени", "Европ"],
  ["Хорват", "Европ"],
  ["Серби", "Европ"],
  ["Монтенегро", "Европ"],
  ["Косово", "Европ"],
  ["Албани", "Европ"],
  ["Хойд Македон", "Европ"],
  ["Босни ба Херцеговин", "Европ"],
  ["Молдав", "Европ"],
  ["Лихтенштейн", "Европ"],
  ["Сан-Марино", "Европ"],
  ["Монако", "Европ"],
  ["Ватикан", "Европ"],
  ["Исланд", "Европ"],
  ["Норвеги", "Европ"],
  ["Швед", "Европ"],
  ["Финлянд", "Европ"],
  ["Дани", "Европ"],
  // Хойд Америк
  ["Белиз", "Хойд Америк"],
  ["Багам", "Хойд Америк"],
  ["Гаити", "Хойд Америк"],
  ["Пуэрто-Рико", "Хойд Америк"],
  ["Тринидад ба Тобаго", "Хойд Америк"],
  // Өмнөд Америк
  ["Гайана", "Өмнөд Америк"],
  ["Суринам", "Өмнөд Америк"],
  // Африк (нэмэлт)
  ["Того", "Африк"],
  ["Бенин", "Африк"],
  ["Мали", "Африк"],
  ["Нигер", "Африк"],
  ["Чад", "Африк"],
  ["Төв Африкийн БНУ", "Африк"],
  ["Габон", "Африк"],
  ["Конго", "Африк"],
  ["Бүгд Найрамдах Ардчилсан Конго Улс", "Африк"],
  ["Руанда", "Африк"],
  ["Бурунди", "Африк"],
  ["Сомали", "Африк"],
  ["Судан", "Африк"],
  ["Өмнөд Судан", "Африк"],
  // Далайн орнууд
  ["Фижи", "Далайн орнууд"],
  ["Самоа", "Далайн орнууд"],
  ["Тонга", "Далайн орнууд"],
  ["Вануату", "Далайн орнууд"],
  ["Папуа Шинэ Гвиней", "Далайн орнууд"],
  ["Соломоны арлууд", "Далайн орнууд"]
];

const worldCurrencies = [
  ["Монгол", "Төгрөг (MNT)"],
  ["АНУ", "Ам.доллар (USD)"],
  ["Евро бүс", "Евро (EUR)"],
  ["Япон", "Иен (JPY)"],
  ["Их Британи", "Фунт стерлинг (GBP)"],
  ["Хятад", "Юань/Жэньминьби (CNY)"],
  ["БНСУ", "Вон (KRW)"],
  ["ОХУ", "Рубль (RUB)"],
  ["Канад", "Канад доллар (CAD)"],
  ["Австрали", "Австрали доллар (AUD)"],
  ["Швейцарь", "Швейцарь франк (CHF)"],
  ["Энэтхэг", "Рупи (INR)"],
  ["Бразил", "Реал (BRL)"],
  ["Мексик", "Песо (MXN)"],
  ["Турк", "Лира (TRY)"],
  ["Саудын Араб", "Риал (SAR)"],
  ["АНЭУ", "Дирхам (AED)"],
  ["Өмнөд Африк", "Рэнд (ZAR)"],
  ["Швед", "Крона (SEK)"],
  ["Норвеги", "Крона (NOK)"],
  ["Дани", "Крона (DKK)"],
  // нэмэлт (мэдлэг)
  ["Япон", "Иен (JPY)"],
  ["Хонгконг", "Хонгконг доллар (HKD)"],
  ["Сингапур", "Сингапур доллар (SGD)"],
  ["Малайз", "Ринггит (MYR)"],
  ["Тайланд", "Бат (THB)"],
  ["Вьетнам", "Донг (VND)"],
  ["Индонез", "Рупиа (IDR)"],
  ["Филиппин", "Песо (PHP)"],
  ["Израиль", "Шинэ шекель (ILS)"],
  ["Иран", "Риал (IRR)"],
  ["Казахстан", "Тэнгэ (KZT)"],
  ["Узбекистан", "Сум (UZS)"],
  ["Киргизстан", "Сом (KGS)"],
  ["Шинэ Зеланд", "Шинэ Зеланд доллар (NZD)"],
  ["Норвеги", "Крона (NOK)"],
  ["Швед", "Крона (SEK)"],
  ["Чех", "Крона (CZK)"],
  ["Польш", "Злот (PLN)"],
  ["Унгар", "Форинт (HUF)"],
  ["Румын", "Лей (RON)"],
  ["Болгар", "Лев (BGN)"],
  ["Украин", "Гривня (UAH)"],
  ["Хорват", "Евро (EUR)"],
  ["Серби", "Динар (RSD)"],
  ["Египет", "Египет фунт (EGP)"],
  ["Марокко", "Дирхам (MAD)"],
  ["Нигери", "Найра (NGN)"],
  ["Кени", "Шиллинг (KES)"],
  ["Этиоп", "Бирр (ETB)"],
  ["Гана", "Седи (GHS)"],
  ["Танзани", "Шиллинг (TZS)"],
  ["Уганда", "Шиллинг (UGX)"],
  ["Замби", "Квача (ZMW)"],
  ["Ботсвана", "Пула (BWP)"],
  ["Намиби", "Намиби доллар (NAD)"],
  ["Аргентин", "Песо (ARS)"],
  ["Чили", "Песо (CLP)"],
  ["Перу", "Соль (PEN)"],
  ["Колумб", "Песо (COP)"],
  ["Эквадор", "Ам.доллар (USD)"]
];

const termDefinitions = [
  // Технологи / кибер
  ["Технологи", "Фишинг", "Хуурамч холбоос/мессежээр нууц мэдээлэл (нууц үг гэх мэт) авч мэхлэх арга."],
  ["Технологи", "VPN", "Сүлжээгээр дамжих өгөгдлийг шифрлэн хамгаалж, виртуал хувийн сүлжээ үүсгэдэг үйлчилгээ."],
  ["Технологи", "2FA/MFA", "Нэвтрэлтийг нэмэлт баталгаажуулалтаар (код, апп гэх мэт) хамгаалах арга."],
  ["Технологи", "DNS", "Домэйн нэрийг IP хаяг руу хөрвүүлдэг систем."],
  ["Технологи", "API", "Програмууд хооронд өгөгдөл/үйлдлийг холбох интерфэйс."],
  ["Технологи", "HTTPS", "Вебийн өгөгдөл дамжуулалтыг шифрлэдэг хамгаалалттай HTTP."],
  ["Технологи", "JWT", "Токеноор баталгаажуулалт хийхэд түгээмэл хэрэглэдэг JSON суурьтай тэмдэгт."],
  // Эдийн засаг (concept)
  ["Ерөнхий", "Инфляци", "Нийт үнийн түвшин өсөхтэй холбоотойгоор мөнгөний худалдан авах чадвар буурах үзэгдэл."],
  ["Ерөнхий", "Хүү", "Зээлсэн мөнгийг ашигласны төлбөр (процент)."],
  ["Ерөнхий", "Төсөв", "Тодорхой хугацааны орлого, зарлагын төлөвлөгөө."],
  ["Ерөнхий", "Эрсдэлийн тархалт", "Хөрөнгө оруулалтыг олон төрөлд хувааж эрсдэлийг бууруулах зарчим."],
  ["Ерөнхий", "Ханш", "Нэг валютыг нөгөө валюттай харьцуулсан үнэ цэнэ."],
  ["Ерөнхий", "НӨАТ", "Нэмэгдсэн өртгийн албан татвар."],
  ["Ерөнхий", "Кредит түүх", "Хүн/байгууллагын зээл төлөлтийн өмнөх түүхэн мэдээлэл."],
  ["Ерөнхий", "Зээлжих чадвар", "Зээлээ хугацаандаа төлөх боломж, үнэлгээ."],
  ["Ерөнхий", "Хуримтлал", "Ирээдүйн хэрэгцээнд зориулан мөнгө/нөөцөө тогтмол хадгалах үйлдэл."],
  // Шинжлэх ухаан (concept)
  ["Шинжлэх ухаан", "DNA", "Амьд биеийн удамшлын мэдээлэл хадгалдаг молекул."],
  ["Шинжлэх ухаан", "Митохондри", "Эсийн энерги (ATP) үүсгэхэд чухал оролцдог эрхтэнцэр."],
  ["Шинжлэх ухаан", "Хүлэмжийн эффект", "Агаар мандал дулааныг барьж дэлхийн температур өсөхөд нөлөөлөх үзэгдэл."],
  ["Шинжлэх ухаан", "Тектоник хавтан", "Дэлхийн царцдас хэд хэдэн том хавтнаас тогтдог, хөдөлгөөн нь газар хөдлөлт, уул үүсэлтэд нөлөөлдөг."],
  ["Шинжлэх ухаан", "pH", "Уусмалын хүчиллэг/шүлтлэгийн хэмжээг илэрхийлэх үзүүлэлт."],
  ["Шинжлэх ухаан", "Антибиотик", "Бактерийн өсөлтийг дарангуйлж эсвэл устгах эмийн бүлэг."],
  ["Шинжлэх ухаан", "Вирус", "Эсгүй бүтэцтэй, үржихдээ заавал амьд эс шаарддаг бичил биет."],
  ["Шинжлэх ухаан", "Нейрон", "Мэдрэлийн системийн мэдээлэл дамжуулах үндсэн эс."],
  ["Шинжлэх ухаан", "Хар нүх", "Таталцал нь маш хүчтэй тул гэрэл ч зугтаж чаддаггүй огторгуйн биет."],
  ["Шинжлэх ухаан", "Изотоп", "Нэг элемент боловч нейтроны тоо өөр атом."],
  ["Шинжлэх ухаан", "Витамин", "Биеийн бодисын солилцоонд бага хэмжээгээр хэрэгтэй органик нэгдэл."],
  // Эрүүл мэнд (ерөнхий ойлголт)
  ["Байгаль", "Дархлаа", "Бие организм халдвар, өвчин үүсгэгчээс хамгаалах систем."],
  ["Байгаль", "Вакцин", "Дархлааг сургаж, тодорхой өвчнөөс сэргийлэх зориулалттай бэлдмэл."],
  ["Байгаль", "Дегидратаци", "Биеийн шингэн дутагдах байдал."],
  ["Байгаль", "Бодисын солилцоо", "Биеийн энерги үүсэлт ба бодисын хувирлын нийт процесс."],
  ["Байгаль", "Артерийн даралт", "Судасны хананд цусны үзүүлэх даралт (BP)."],
  ["Байгаль", "Холестерин", "Цусанд байдаг өөхлөг бодис; тодорхой хэмжээ нь хэрэгтэй ч ихсэхэд эрсдэл нэмэгдэнэ."],
  ["Байгаль", "BMI", "Биеийн жинг өндрийн квадратад хуваасан индекс (ерөнхий үнэлгээ)."],
  ["Байгаль", "Аэроб дасгал", "Зүрх-судасны тэсвэр сайжруулах, хүчилтөрөгч ашигладаг хөдөлгөөн."],
  ["Байгаль", "Уураг", "Эсийн бүтэц, фермент, булчин зэрэгт чухал шим тэжээл."],
  ["Байгаль", "Нүүрс ус", "Энергийн гол эх үүсвэрийн нэг шим тэжээл."],
  ["Байгаль", "Өөх тос", "Энерги хадгалах, даавар, эсийн мембран зэрэгт хэрэгтэй шим тэжээл."],
  // Соёл
  ["Соёл", "Импрессионизм", "Гэрэл, сэтгэгдлийг өнгө ба богино мазкаар илэрхийлэх уран зургийн урсгал."],
  ["Соёл", "Симфони", "Олон хэсгээс бүрдэх, найрал хөгжимд зориулсан том хэмжээний хөгжмийн зохиол."],
  ["Соёл", "Документаль кино", "Бодит үйл явдал, бодит хүмүүсийг баримтад тулгуурлан өгүүлдэг кино төрөл."],
  ["Соёл", "Роман", "Урт хэмжээний уран зохиолын төрөл."],
  ["Соёл", "Шүлэг", "Хэмнэл, дүрслэл, хэл найруулга давамгай уран бүтээлийн төрөл."],
  ["Соёл", "Театр", "Тайзны жүжиглэлээр өгүүлэмжийг үзүүлдэг урлаг."],
  ["Соёл", "Жазз", "Импровизаци, синкоп хэмнэлээрээ онцлог хөгжмийн урсгал."],
  ["Соёл", "Блюз", "Африк-америк гаралтай, 12 тактын хэлбэр түгээмэл хөгжмийн урсгал."],
  ["Соёл", "Рок", "Гитар төвтэй, хүчтэй хэмнэлтэй орчин үеийн хөгжмийн урсгал."],
  ["Соёл", "Кино зохиол", "Киноны үйл явдал, дүр, харилцан яриаг бичвэрээр төлөвлөсөн зохиол."],
  ["Соёл", "Найруулга", "Кино/жүжгийн үзэгдэл, дүр, хэмнэлийг удирдан бүтээх үйл явц."],
  ["Соёл", "Гэрэл зураг", "Гэрлээр дүрсийг мэдрэгч/плёнк дээр буулгах урлаг, техник."],
  ["Соёл", "Архитектур", "Барилга байгууламжийн зураг төсөл, хэлбэр, орон зайн урлаг."],
  ["Соёл", "Уран баримал", "Хатуу материалд хэлбэр гарган бүтээдэг дүрслэх урлаг."],
  ["Соёл", "Уран зураг", "Будгаар дүрс, өнгө, зохиомж ашиглан илэрхийлэх дүрслэх урлаг."],
  ["Соёл", "Лого/брэнд", "Байгууллага/бүтээгдэхүүнийг таних тэмдэг, нэршил, дүр төрх."],
  // Түүх (ерөнхий, өргөн мэдлэг)
  ["Түүх", "Ренессанс", "Европт урлаг, шинжлэх ухаан, соёл сэргэсэн түүхэн үе (ойролцоогоор 14–17-р зуун)."],
  ["Түүх", "Үйлдвэрлэлийн хувьсгал", "Машинжуулалт, үйлдвэржилт эрчимжиж эдийн засаг, нийгэм өөрчлөгдсөн үе."],
  ["Түүх", "Хүйтэн дайн", "АНУ ба ЗХУ төвтэй геополитикийн өрсөлдөөн (зэвсэгт шууд мөргөлдөөнөөс илүү сөргөлдөөн)."],
  ["Түүх", "Колоничлол", "Нэг улс нөгөөгийн газар нутаг/нөөцийг эрхшээлдээ оруулан захирч ашиглах явц."],
  ["Түүх", "Үндсэн хууль", "Төрийн байгуулал, иргэний эрх, эрх мэдлийн хуваарилалтыг тогтоосон дээд хууль."],
  ["Түүх", "Парламент", "Хууль тогтоох байгууллага (төлөөллийн байгууллага)."],
  ["Түүх", "Ардчилал", "Иргэдийн оролцоо, сонгуулиар төлөөллөө бүрдүүлдэг засаглалын хэлбэр."],
  ["Түүх", "Диктатур", "Нэг хүн/цөөн бүлэг эрх мэдлийг төвлөрүүлж хяналттайгаар барих засаглал."],
  ["Түүх", "Гэрээ", "Талуудын эрх, үүргийг тогтоосон хууль зүйн тохиролцоо."],
  // Спорт (ойлголтууд)
  ["Спорт", "Марафон", "42.195 км-ийн гүйлтийн зай."],
  ["Спорт", "Хет-трик", "Нэг тоглолтод 3 гоол/оноо хийх (спортын төрлөөс хамаарч)."],
  ["Спорт", "Оффсайд", "Хөлбөмбөгт довтлогч бөмбөгөөс урд, хамгаалагчдаас давуу байрлалд байх үед үүсэх дүрэм."],
  ["Спорт", "Сет", "Теннис/волейбол зэрэгт тоглолтын дэд нэгж онооны хэсэг."],
  ["Спорт", "Нокаут", "Тулааны спортод цохилтоор үргэлжлүүлэх боломжгүй болж ялагдах нөхцөл."],
  ["Спорт", "Допинг", "Гүйцэтгэлийг хиймлээр сайжруулах хориотой бодис/арга хэрэглэх."],
  ["Спорт", "Тэсвэр", "Удаан хугацаанд ачаалал даах чадвар."],
  ["Спорт", "Хурд", "Хөдөлгөөнийг богино хугацаанд хийх чадвар."],
  ["Спорт", "Хүч", "Булчингийн хүчний үзүүлэлт."],
  // Байгаль / экологи
  ["Байгаль", "Биологийн олон янз байдал", "Амьд биетүүдийн төрөл зүйл, экосистемийн баялаг, ялгаатай байдал."],
  ["Байгаль", "Экосистем", "Амьд биет ба орчны харилцан үйлчлэл бүхий систем."],
  ["Байгаль", "Сэргээгдэх эрчим хүч", "Нар, салхи, ус зэрэг байнга нөхөгдөх эх үүсвэрийн эрчим хүч."],
  ["Байгаль", "Нүүрстөрөгчийн ул мөр", "Хүний үйл ажиллагаанаас үүсэх хүлэмжийн хийн нийт ялгарлын хэмжээ."],
  ["Байгаль", "Дахин боловсруулах", "Хог хаягдлыг ангилан боловсруулж дахин ашиглах процесс."],
  ["Байгаль", "Цөлжилт", "Хөрс доройтож ургамалжил багасах явц."],
  ["Байгаль", "Агаарын бохирдол", "Агаар дахь бохирдуулагч бодисын түвшин эрүүл мэнд, байгальд сөргөөр нөлөөлөх хэмжээнд хүрэх."],
  // Монгол (ойлголтууд)
  ["Монгол", "Соёмбо", "Монголын тусгаар тогтнол, төрийн бэлгэдлийг илэрхийлсэн уламжлалт тэмдэг."],
  ["Монгол", "Аймаг", "Монгол Улсын засаг захиргааны нэгж."],
  ["Монгол", "Сум", "Аймгийн дотоод засаг захиргааны нэгж."],
  ["Монгол", "Гэр", "Нүүдэлчдийн уламжлалт дугуй хэлбэртэй сууц."],
  ["Монгол", "Наадам", "Үндэсний баяр наадам; бөх, сур, морь зэрэг уламжлалт спортын наадам."],
];

const abbrevPairs = [
  ["Технологи", "CPU", "Төв боловсруулалтын нэгж (Central Processing Unit)"],
  ["Технологи", "GPU", "График боловсруулалтын нэгж (Graphics Processing Unit)"],
  ["Технологи", "RAM", "Санамсаргүй хандалтын санах ой (Random Access Memory)"],
  ["Технологи", "SSD", "Хатуу төлөвт диск (Solid State Drive)"],
  ["Технологи", "URL", "Вебийн хаяг (Uniform Resource Locator)"],
  ["Технологи", "IP", "Интернэт протоколын хаяг (Internet Protocol)"],
  ["Технологи", "UI", "Хэрэглэгчийн интерфэйс (User Interface)"],
  ["Технологи", "UX", "Хэрэглэгчийн туршлага (User Experience)"],
  ["Технологи", "JSON", "Өгөгдөл солилцооны JSON формат"],
  ["Технологи", "HTML", "Вебийн тэмдэглэгээний хэл (HyperText Markup Language)"],
  ["Технологи", "CSS", "Загварчлалын хэл (Cascading Style Sheets)"],
  ["Технологи", "SQL", "Өгөгдлийн асуулгын хэл (Structured Query Language)"],
  ["Технологи", "VPN", "Виртуал хувийн сүлжээ (Virtual Private Network)"],
  ["Технологи", "DNS", "Домэйн нэрийн систем (Domain Name System)"],
  ["Технологи", "API", "Програмын интерфэйс (Application Programming Interface)"],
  ["Технологи", "OTP", "Нэг удаагийн нууц үг (One-Time Password)"],
  ["Ерөнхий", "GDP", "Дотоодын нийт бүтээгдэхүүн (Gross Domestic Product)"],
  ["Ерөнхий", "CPI", "Хэрэглээний үнийн индекс (Consumer Price Index)"],
  ["Ерөнхий", "ROI", "Хөрөнгө оруулалтын өгөөж (Return on Investment)"],
  ["Ерөнхий", "KPI", "Гүйцэтгэлийн гол үзүүлэлт (Key Performance Indicator)"]
];

function addAcronymQuestions() {
  const acronyms = abbrevPairs.map(([, a]) => a);
  const meanings = abbrevPairs.map(([, , m]) => m);
  for (const [cat, a, m] of abbrevPairs) {
    questions.push(
      makeMCQ({
        category: cat,
        question: `“${a}” товчлолын зөв тайлбар аль вэ?`,
        correct: m,
        wrongs: shuffle(meanings.filter((x) => x !== m)).slice(0, 10),
        explanation: `${a} = ${m}.`,
        difficulty: 2
      })
    );
    questions.push(
      makeMCQ({
        category: cat,
        question: `“${m}” аль товчлолд тохирох вэ?`,
        correct: a,
        wrongs: shuffle(acronyms.filter((x) => x !== a)).slice(0, 10),
        explanation: `${a} = ${m}.`,
        difficulty: 2
      })
    );
  }
}

function addDefinitionQuestions() {
  const byCategory = new Map();
  for (const [cat, term, def] of termDefinitions) {
    if (!byCategory.has(cat)) byCategory.set(cat, []);
    byCategory.get(cat).push([term, def]);
  }

  for (const [cat, pairs] of byCategory.entries()) {
    const defs = pairs.map(([, def]) => def);
    for (const [term, def] of pairs) {
      questions.push(
        makeMCQ({
          category: cat,
          question: `“${term}” гэж юу вэ?`,
          correct: def,
          wrongs: shuffle(defs.filter((x) => x !== def)).slice(0, 10),
          explanation: def,
          difficulty: 2
        })
      );
    }
  }
}

const periodicBasics = [
  ["H", "Устөрөгч"],
  ["He", "Гели"],
  ["C", "Нүүрстөрөгч"],
  ["N", "Азот"],
  ["O", "Хүчилтөрөгч"],
  ["Na", "Натри"],
  ["K", "Кали"],
  ["Ca", "Кальци"],
  ["Fe", "Төмөр"],
  ["Cu", "Зэс"],
  ["Ag", "Мөнгө"],
  ["Au", "Алт"]
];

const scienceFacts = [
  {
    category: "Шинжлэх ухаан",
    question: "Гэрлийн хурд вакуум орчинд ойролцоогоор хэд вэ?",
    choices: ["300 000 км/с", "30 000 км/с", "3 000 км/с", "300 км/с"],
    answerIndex: 0,
    explanation: "Вакуум дахь гэрлийн хурд ≈ 299 792 км/с.",
    difficulty: 2
  },
  {
    category: "Шинжлэх ухаан",
    question: "Ус хэдэн °C-д буцалдаг вэ? (далайн түвшинд)",
    choices: ["100°C", "0°C", "50°C", "120°C"],
    answerIndex: 0,
    explanation: "Далайн түвшинд ус 100°C-д буцална.",
    difficulty: 1
  },
  {
    category: "Байгаль",
    question: "Фотосинтезийн үед ургамал голчлон ямар хийг шингээдэг вэ?",
    choices: ["Нүүрсхүчлийн хий (CO₂)", "Хүчилтөрөгч (O₂)", "Азот (N₂)", "Гели (He)"],
    answerIndex: 0,
    explanation: "Ургамал CO₂ шингээж, O₂ ялгаруулна.",
    difficulty: 1
  },
  {
    category: "Шинжлэх ухаан",
    question: "Дэлхийн таталцлын хурдатгал ойролцоогоор хэд вэ?",
    choices: ["9.8 м/с²", "98 м/с²", "1.8 м/с²", "0.98 м/с²"],
    answerIndex: 0,
    explanation: "Далайн түвшинд \(g \\approx 9.8\\,м/с^2\\).",
    difficulty: 1
  }
];

const mongoliaHistoryCulture = [
  makeDirectMCQ({
    category: "Монгол",
    question: "Монгол Улсын нийслэл хот аль вэ?",
    choices: ["Улаанбаатар", "Эрдэнэт", "Дархан", "Хархорин"],
    answerIndex: 0,
    explanation: "Нийслэл: Улаанбаатар.",
    difficulty: 1
  }),
  makeDirectMCQ({
    category: "Монгол",
    question: "Монголын үндэсний баяр наадам ихэвчлэн хэддүгээр сард болдог вэ?",
    choices: ["7-р сар", "1-р сар", "10-р сар", "3-р сар"],
    answerIndex: 0,
    explanation: "Наадам ихэвчлэн 7-р сарын 11–13-нд болдог.",
    difficulty: 1
  }),
  makeDirectMCQ({
    category: "Түүх",
    question: "Монголын эзэнт гүрнийг үндэслэгч хэн бэ?",
    choices: ["Чингис хаан", "Өгэдэй хаан", "Хубилай хаан", "Мандухай хатан"],
    answerIndex: 0,
    explanation: "1206 онд Чингис хаан Их Монгол улсыг байгуулсан гэж үздэг.",
    difficulty: 1
  })
];

// -----------------------------
// GENERATED QUESTION SETS
// -----------------------------

// 1) Mongolia: aimag centers (2 directions)
{
  const aimags = mongoliaAimagCenters.map(([a]) => a);
  const centers = mongoliaAimagCenters.map(([, c]) => c);

  for (const [a, c] of mongoliaAimagCenters) {
    // Q: Aimag center?
    questions.push(
      makeMCQ({
        category: "Монгол",
        question: `${a} аймгийн төв аль вэ?`,
        correct: c,
        wrongs: shuffle(centers.filter((x) => x !== c)).slice(0, 6),
        explanation: `${a} аймгийн төв нь ${c}.`,
        difficulty: 1
      })
    );
    // Q: Which aimag has center?
    questions.push(
      makeMCQ({
        category: "Монгол",
        question: `${c} хот аль аймгийн төв вэ?`,
        correct: a,
        wrongs: shuffle(aimags.filter((x) => x !== a)).slice(0, 6),
        explanation: `${c} бол ${a} аймгийн төв.`,
        difficulty: 2
      })
    );
  }
}

// 2) World capitals (2 directions)
{
  const countries = worldCapitals.map(([c]) => c);
  const capitals = worldCapitals.map(([, k]) => k);
  let i = 0;
  for (const [country, capital] of worldCapitals) {
    i++;
    questions.push(
      makeMCQ({
        category: "Газарзүй",
        question: `${country} улсын нийслэл аль вэ?`,
        correct: capital,
        wrongs: shuffle(capitals.filter((x) => x !== capital)).slice(0, 8),
        explanation: `${country} улсын нийслэл нь ${capital}.`,
        difficulty: 1
      })
    );
    // Reverse-capital questions are useful but can become spammy; keep only ~25%
    if (i % 4 === 0) {
      questions.push(
        makeMCQ({
          category: "Газарзүй",
          question: `${capital} хот аль улсын нийслэл вэ?`,
          correct: country,
          wrongs: shuffle(countries.filter((x) => x !== country)).slice(0, 8),
          explanation: `${capital} бол ${country} улсын нийслэл.`,
          difficulty: 2
        })
      );
    }
  }
}

// 3) Periodic table basics
{
  const symbols = periodicBasics.map(([s]) => s);
  const names = periodicBasics.map(([, n]) => n);
  for (const [sym, name] of periodicBasics) {
    questions.push(
      makeMCQ({
        category: "Шинжлэх ухаан",
        question: `${sym} тэмдэглэгээтэй элемент аль вэ?`,
        correct: name,
        wrongs: shuffle(names.filter((x) => x !== name)).slice(0, 8),
        explanation: `${sym} = ${name}.`,
        difficulty: 2
      })
    );
    questions.push(
      makeMCQ({
        category: "Шинжлэх ухаан",
        question: `${name} элементийн тэмдэглэгээ аль вэ?`,
        correct: sym,
        wrongs: shuffle(symbols.filter((x) => x !== sym)).slice(0, 8),
        explanation: `${name} = ${sym}.`,
        difficulty: 2
      })
    );
  }
}

// 4) Continents (adult-friendly geography)
{
  const continents = ["Ази", "Европ", "Африк", "Хойд Америк", "Өмнөд Америк", "Далайн орнууд"];
  // Keep a limited sample to avoid geography spam
  const sample = shuffle([...countryContinents]).slice(0, 140);
  for (const [country, cont] of sample) {
    questions.push(
      makeMCQ({
        category: "Газарзүй",
        question: `${country} улс аль тивд багтдаг вэ?`,
        correct: cont,
        wrongs: shuffle(continents.filter((x) => x !== cont)).slice(0, 10),
        explanation: `${country} улс ${cont}-д багтана.`,
        difficulty: 1
      })
    );
  }
}

// 4.1) Reverse continent questions (more “knowledge”, not math)
{
  const byCont = new Map();
  for (const [country, cont] of countryContinents) {
    if (!byCont.has(cont)) byCont.set(cont, []);
    byCont.get(cont).push(country);
  }
  const continents = Array.from(byCont.keys());
  for (const cont of continents) {
    const correctList = byCont.get(cont);
    // keep smaller count (still fun, less repetitive)
    for (let i = 0; i < 18; i++) {
      const correctCountry = correctList[randInt(0, correctList.length - 1)];
      const wrongContinents = shuffle(continents.filter((c) => c !== cont)).slice(0, 3);
      const wrongCountries = wrongContinents.map((c) => {
        const list = byCont.get(c);
        return list[randInt(0, list.length - 1)];
      });
      questions.push(
        makeMCQ({
          category: "Газарзүй",
          question: `Аль улс ${cont}-д багтдаг вэ?`,
          correct: correctCountry,
          wrongs: wrongCountries,
          explanation: `${correctCountry} улс ${cont}-д багтана.`,
          difficulty: 2
        })
      );
    }
  }
}

// 5) Currencies (adult-friendly)
{
  const currencyNames = worldCurrencies.map(([, cur]) => cur);
  const sample = shuffle([...worldCurrencies]).slice(0, 90);
  for (const [place, cur] of sample) {
    questions.push(
      makeMCQ({
        category: "Ерөнхий",
        question: `${place} — мөнгөн тэмдэгт аль вэ?`,
        correct: cur,
        wrongs: shuffle(currencyNames.filter((x) => x !== cur)).slice(0, 10),
        explanation: `${place} — ${cur}.`,
        difficulty: 2
      })
    );
  }
}

// 5.1) Reverse currency questions (limited)
{
  const places = worldCurrencies.map(([p]) => p);
  const currencyNames = worldCurrencies.map(([, cur]) => cur);
  let i = 0;
  const sample = shuffle([...worldCurrencies]).slice(0, 80);
  for (const [place, cur] of sample) {
    i++;
    if (i % 2 !== 0) continue; // keep ~50%
    questions.push(
      makeMCQ({
        category: "Ерөнхий",
        question: `${cur} — аль улсын/бүсийн мөнгөн тэмдэгт вэ?`,
        correct: place,
        wrongs: shuffle(places.filter((x) => x !== place)).slice(0, 10),
        explanation: `${cur} нь ${place}-ийн мөнгөн тэмдэгт.`,
        difficulty: 2
      })
    );
  }
  // also add a few “pick the correct currency” questions
  for (let k = 0; k < 40; k++) {
    const [place, cur] = sample[randInt(0, sample.length - 1)];
    questions.push(
      makeMCQ({
        category: "Ерөнхий",
        question: `Аль нь ${place}-ийн мөнгөн тэмдэгт вэ?`,
        correct: cur,
        wrongs: shuffle(currencyNames.filter((x) => x !== cur)).slice(0, 10),
        explanation: `${place} — ${cur}.`,
        difficulty: 2
      })
    );
  }
}

// 6) Definitions + Acronyms (adult-friendly)
// Keep some “concept” questions, but don’t let them dominate the whole bank.
addDefinitionQuestions();
// Acronyms are fun but can feel “exam-like”; keep only 1-direction (handled below)
function addAcronymQuestionsOneWay() {
  const meanings = abbrevPairs.map(([, , m]) => m);
  for (const [cat, a, m] of abbrevPairs) {
    questions.push(
      makeMCQ({
        category: cat,
        question: `“${a}” товчлолын зөв тайлбар аль вэ?`,
        correct: m,
        wrongs: shuffle(meanings.filter((x) => x !== m)).slice(0, 10),
        explanation: `${a} = ${m}.`,
        difficulty: 2
      })
    );
  }
}
addAcronymQuestionsOneWay();

// 7) Math generator removed (requested): no math questions
function makeNumberChoices(correct) {
  const deltas = uniq([1, 2, 3, 4, 5, 7, 9].map((d) => (rng() > 0.5 ? d : -d)));
  const wrongs = [];
  for (const d of deltas) {
    const v = correct + d;
    if (v !== correct) wrongs.push(String(v));
  }
  // add some scaled wrongs
  wrongs.push(String(correct + 10));
  wrongs.push(String(Math.max(0, correct - 10)));
  return shuffle(uniq(wrongs)).slice(0, 10);
}

// 5) Add curated sets
questions.push(...mongoliaHistoryCulture);
for (const f of scienceFacts) questions.push(makeDirectMCQ(f));

// 6) Tech basics (curated + light generated)
const techFacts = [
  {
    category: "Технологи",
    question: "Интернэтэд веб хуудас хүсэхэд хамгийн түгээмэл ашиглагддаг протокол аль вэ?",
    choices: ["HTTP/HTTPS", "FTP", "SMTP", "SSH"],
    answerIndex: 0,
    explanation: "Веб хуудасны үндсэн протокол нь HTTP/HTTPS."
  },
  {
    category: "Технологи",
    question: "Компьютерийн RAM санах ой нь ямар төрлийнх вэ?",
    choices: ["Түр (цахилгаан тасарвал арилна)", "Байнгын (хадгалагдана)", "Оптик диск", "Соронзон тууз"],
    answerIndex: 0,
    explanation: "RAM нь volatile буюу түр санах ой."
  },
  {
    category: "Технологи",
    question: "QR кодыг ихэвчлэн юугаар уншдаг вэ?",
    choices: ["Ухаалаг утасны камер/сканнер", "Микрофон", "Дулаан мэдрэгч", "GPS"],
    answerIndex: 0,
    explanation: "Камер эсвэл QR уншигч апп ашиглана."
  }
];
for (const t of techFacts) questions.push(makeDirectMCQ(t));

// Generated: binary/decimal quick (keep limited; too many feels like a coding test)
for (let i = 0; i < 60; i++) {
  const n = randInt(2, 255);
  const bin = n.toString(2);
  const wrongs = shuffle([randInt(2, 255), randInt(2, 255), randInt(2, 255), randInt(2, 255)].map(String)).filter(
    (x) => x !== String(n)
  );
  questions.push(
    makeMCQ({
      category: "Технологи",
      question: `2-ын тооллын системд ${bin} (₂) нь 10-ын тооллын системд хэд вэ?`,
      correct: String(n),
      wrongs,
      explanation: `${bin}₂ = ${n}₁₀.`,
      difficulty: 2
    })
  );
}

// 7) Sports & Culture small sets
const misc = [
  {
    category: "Спорт",
    question: "Олимпийн наадам хэдэн жил тутам болдог вэ?",
    choices: ["4 жил", "2 жил", "3 жил", "5 жил"],
    answerIndex: 0,
    explanation: "Олимп 4 жил тутам зохиогдоно."
  },
  {
    category: "Соёл",
    question: "Монгол үндэсний хөгжмийн зэмсэг аль нь вэ?",
    choices: ["Морин хуур", "Гитар", "Саксофон", "Пианино"],
    answerIndex: 0,
    explanation: "Морин хуур нь Монголын уламжлалт хөгжим."
  },
  {
    category: "Ерөнхий",
    question: "Дэлхийн хамгийн том далай аль вэ?",
    choices: ["Номхон далай", "Атлантын далай", "Энэтхэгийн далай", "Хойд мөсөн далай"],
    answerIndex: 0,
    explanation: "Номхон далай хамгийн том."
  },
  {
    category: "Ерөнхий",
    question: "Нэг жил нийт хэдэн сар байдаг вэ?",
    choices: ["12", "10", "11", "13"],
    answerIndex: 0,
    explanation: "Нэг жил 12 сар."
  }
];
for (const m of misc) questions.push(makeDirectMCQ(m));

// Mongolia everyday (more relatable)
for (const t of mongoliaEverydayTrivia) questions.push(makeDirectMCQ(t));

// Generated: pick UB district
{
  const wrongPool = shuffle([...mongoliaAimagCenters.map(([a]) => a), "Дархан", "Эрдэнэт", "Хархорин"]);
  for (let i = 0; i < 80; i++) {
    const correct = ubDistricts[randInt(0, ubDistricts.length - 1)];
    const wrongs = shuffle(wrongPool.filter((x) => x !== correct)).slice(0, 8);
    questions.push(
      makeMCQ({
        category: "Монгол",
        question: "Доорх аль нь Улаанбаатарын дүүрэг вэ?",
        correct,
        wrongs,
        explanation: `${correct} бол Улаанбаатарын дүүрэг.`,
        difficulty: 1
      })
    );
  }
}

// Generated: pick Mongolian food
{
  const wrongFoods = [...nonMongolianFoods, ...mongolianFoods];
  for (let i = 0; i < 90; i++) {
    const correct = mongolianFoods[randInt(0, mongolianFoods.length - 1)];
    questions.push(
      makeMCQ({
        category: "Монгол",
        question: "Доорх аль нь Монгол хоол вэ?",
        correct,
        wrongs: shuffle(wrongFoods.filter((x) => x !== correct)).slice(0, 10),
        explanation: `${correct} бол Монгол хоол.`,
        difficulty: 1
      })
    );
  }
}

// Generated: pick dairy product (цагаан идээ)
{
  const pool = [...mongolianDairy, ...nonMongolianFoods];
  for (let i = 0; i < 70; i++) {
    const correct = mongolianDairy[randInt(0, mongolianDairy.length - 1)];
    questions.push(
      makeMCQ({
        category: "Монгол",
        question: "Доорх аль нь цагаан идээний төрөл вэ?",
        correct,
        wrongs: shuffle(pool.filter((x) => x !== correct)).slice(0, 10),
        explanation: `${correct} бол цагаан идээний төрөл.`,
        difficulty: 1
      })
    );
  }
}

// 7.5) Curated knowledge trivia (more varied “general knowledge”)
for (const t of knowledgeTrivia) questions.push(makeDirectMCQ(t));

// 8) Remove low-signal numeric-comparison spam (too close to kids-math).

// Ensure we have 1000+
const noMath = questions.filter((q) => q.category !== "Математик");
if (noMath.length < 1000) {
  throw new Error(`Not enough questions generated (no math): ${noMath.length}`);
}

// Keep a clean size: cap at 1200 for now
const finalQuestions = noMath.slice(0, 1200);

const outPath = path.join(process.cwd(), "public", "questions.mn.json");
fs.mkdirSync(path.dirname(outPath), { recursive: true });
// Write to a temp file first, then replace the old file in one step.
// This ensures previous generated questions are NOT kept, and avoids partial/corrupt output if generation crashes.
const tmpPath = path.join(process.cwd(), "public", `questions.mn.${Date.now()}.tmp.json`);
fs.writeFileSync(tmpPath, JSON.stringify(finalQuestions, null, 2), "utf8");
fs.renameSync(tmpPath, outPath);

console.log(`Generated ${finalQuestions.length} questions → ${outPath}`);


